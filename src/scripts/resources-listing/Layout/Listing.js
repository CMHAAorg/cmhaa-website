import React from "react";

class Listing extends React.Component {
  constructor(props) {
    super(props);
    this.listRef = React.createRef();
  }

  getSnapshotBeforeUpdate(prevProps, prevState) {
    /* Get page scroll and pass to component did update to stop it scrolling
    to the bottom when new elements added */
    if (prevProps.page < this.props.page) {
      return window.pageYOffset;
    }

    return null;
  }

  componentDidUpdate(prevProps, prevState, snapshot) {
    if (snapshot !== null) {
      window.scrollTo(window.pageXOffset, snapshot);
    }
  }

  render() {
    const pagedItems = this.props.page * this.props.perPage;

    const cards = this.props.results
      .filter((result, index) => index < pagedItems)
      .map((result) => {
        const image = result.banner_image ? result.banner_image : "/img/placeholder-noimage.gif";
        return (
          <a href={result.permalink} key={result.permalink} className="card card--resource">
            <div className="card__image-wrapper">
              <img src={image} alt="" />
            </div>
            <div className="card__content">
              <span className={`card__category ${result.category_tag}`}>{result.category}</span>
              <span className="card__date">{result.post_date}</span>
              <p className="card__title">{result.title}</p>
            </div>
            <p className="card__focus">
              <strong>Focus</strong> {result.focus}
            </p>
          </a>
        );
      });

    const loadingClass = this.props.loading ? " loading" : "";

    const showButton = pagedItems < this.props.results.length;

    return (
      <section className={`resource-listing__listing${loadingClass}`}>
        <div className="uk-container">
          <div className="uk-text-center uk-margin-medium-top uk-margin-medium-bottom">
            Displaying &lt;{this.props.results.length}&gt; resource{this.props.results.length != 1 ? "s" : ""}
          </div>
          <div className="cards-wrapper" ref={this.listRef}>
            {cards}
          </div>
          {showButton ? (
            <div className="uk-text-center uk-margin-large-top uk-margin-large-bottom">
              <button class="btn-show-more" onClick={this.props.pageUpdate}>
                <svg
                  class="C14-friends-cmhaa__button-shown"
                  width="154"
                  height="30"
                  viewBox="0 0 154 30"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M44.166 10.9512L42.5049 11.9355C42.1943 11.3965 41.8984 11.0449 41.6172 10.8809C41.3242 10.6934 40.9463 10.5996 40.4834 10.5996C39.915 10.5996 39.4434 10.7607 39.0684 11.083C38.6934 11.3994 38.5059 11.7979 38.5059 12.2783C38.5059 12.9404 38.998 13.4736 39.9824 13.8779L41.3359 14.4316C42.4375 14.877 43.2432 15.4219 43.7529 16.0664C44.2627 16.7051 44.5176 17.4902 44.5176 18.4219C44.5176 19.6699 44.1016 20.7012 43.2695 21.5156C42.4316 22.3359 41.3916 22.7461 40.1494 22.7461C38.9717 22.7461 37.999 22.3975 37.2314 21.7002C36.4756 21.0029 36.0039 20.0215 35.8164 18.7559L37.8906 18.2988C37.9844 19.0957 38.1484 19.6465 38.3828 19.9512C38.8047 20.5371 39.4199 20.8301 40.2285 20.8301C40.8672 20.8301 41.3975 20.6162 41.8193 20.1885C42.2412 19.7607 42.4521 19.2188 42.4521 18.5625C42.4521 18.2988 42.4141 18.0586 42.3379 17.8418C42.2676 17.6191 42.1533 17.417 41.9951 17.2354C41.8428 17.0479 41.6436 16.875 41.3975 16.7168C41.1514 16.5527 40.8584 16.3975 40.5186 16.251L39.209 15.7061C37.3516 14.9209 36.4229 13.7725 36.4229 12.2607C36.4229 11.2412 36.8125 10.3887 37.5918 9.70312C38.3711 9.01172 39.3408 8.66602 40.501 8.66602C42.0654 8.66602 43.2871 9.42773 44.166 10.9512ZM49.0352 14.2383H54.8887V8.92969H56.9365V22.5H54.8887V16.1631H49.0352V22.5H46.9873V8.92969H49.0352V14.2383ZM59.5117 15.6533C59.5117 13.7432 60.2119 12.1025 61.6123 10.7314C63.0068 9.36035 64.6826 8.6748 66.6396 8.6748C68.5732 8.6748 70.2314 9.36621 71.6143 10.749C73.0029 12.1318 73.6973 13.793 73.6973 15.7324C73.6973 17.6836 73 19.3389 71.6055 20.6982C70.2051 22.0635 68.5146 22.7461 66.5342 22.7461C64.7822 22.7461 63.209 22.1396 61.8145 20.9268C60.2793 19.585 59.5117 17.8271 59.5117 15.6533ZM61.5771 15.6797C61.5771 17.1797 62.0811 18.4131 63.0889 19.3799C64.0908 20.3467 65.248 20.8301 66.5605 20.8301C67.9844 20.8301 69.1855 20.3379 70.1641 19.3535C71.1426 18.3574 71.6318 17.1445 71.6318 15.7148C71.6318 14.2676 71.1484 13.0547 70.1816 12.0762C69.2207 11.0918 68.0312 10.5996 66.6133 10.5996C65.2012 10.5996 64.0088 11.0918 63.0361 12.0762C62.0635 13.0488 61.5771 14.25 61.5771 15.6797ZM76.3604 8.92969L79.8936 18L83.585 8.27051L87.1182 18L90.8711 8.92969H93.0947L87.0303 23.3613L83.541 13.7461L79.9023 23.3701L74.1367 8.92969H76.3604ZM99.8623 22.5L102.719 7.91016L107.377 18.457L112.202 7.91016L114.769 22.5H112.668L111.358 14.3086L107.342 23.124L103.439 14.2998L101.98 22.5H99.8623ZM116.975 15.6533C116.975 13.7432 117.675 12.1025 119.075 10.7314C120.47 9.36035 122.146 8.6748 124.103 8.6748C126.036 8.6748 127.694 9.36621 129.077 10.749C130.466 12.1318 131.16 13.793 131.16 15.7324C131.16 17.6836 130.463 19.3389 129.068 20.6982C127.668 22.0635 125.978 22.7461 123.997 22.7461C122.245 22.7461 120.672 22.1396 119.277 20.9268C117.742 19.585 116.975 17.8271 116.975 15.6533ZM119.04 15.6797C119.04 17.1797 119.544 18.4131 120.552 19.3799C121.554 20.3467 122.711 20.8301 124.023 20.8301C125.447 20.8301 126.648 20.3379 127.627 19.3535C128.605 18.3574 129.095 17.1445 129.095 15.7148C129.095 14.2676 128.611 13.0547 127.645 12.0762C126.684 11.0918 125.494 10.5996 124.076 10.5996C122.664 10.5996 121.472 11.0918 120.499 12.0762C119.526 13.0488 119.04 14.25 119.04 15.6797ZM138.332 16.7168L142.533 22.5H140.028L136.152 16.9453H135.783V22.5H133.735V8.92969H136.135C137.928 8.92969 139.223 9.2666 140.02 9.94043C140.898 10.6904 141.338 11.6807 141.338 12.9111C141.338 13.8721 141.062 14.6982 140.512 15.3896C139.961 16.0811 139.234 16.5234 138.332 16.7168ZM135.783 15.1611H136.434C138.373 15.1611 139.343 14.4199 139.343 12.9375C139.343 11.5488 138.399 10.8545 136.513 10.8545H135.783V15.1611ZM152.069 10.8545H146.629V14.1152H151.911V16.04H146.629V20.5752H152.069V22.5H144.581V8.92969H152.069V10.8545Z"
                    fill="black"
                  />
                  <path
                    d="M15.625 25.1253L14.7494 24.2497L23.9431 15.056C24.1849 14.8142 24.5769 14.8142 24.8187 15.056C25.0604 15.2978 25.0604 15.6898 24.8187 15.9316L15.625 25.1253Z"
                    fill="black"
                  />
                  <path
                    d="M15.625 25.1253L16.5006 24.2497L7.30693 15.056C7.06514 14.8142 6.67313 14.8142 6.43134 15.056C6.18955 15.2978 6.18955 15.6898 6.43134 15.9316L15.625 25.1253Z"
                    fill="black"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M15.6559 4.375C16.0011 4.375 16.2809 4.65482 16.2809 5V23.75H15.0309V5C15.0309 4.65482 15.3108 4.375 15.6559 4.375Z"
                    fill="black"
                  />
                  <path
                    d="M15.625 25.1253L14.7494 24.2497L23.9431 15.056C24.1849 14.8142 24.5769 14.8142 24.8187 15.056C25.0604 15.2978 25.0604 15.6898 24.8187 15.9316L15.625 25.1253ZM15.625 25.1253L16.5006 24.2497L7.30693 15.056C7.06514 14.8142 6.67313 14.8142 6.43134 15.056C6.18955 15.2978 6.18955 15.6898 6.43134 15.9316L15.625 25.1253ZM16.2809 5C16.2809 4.65482 16.0011 4.375 15.6559 4.375C15.3108 4.375 15.0309 4.65482 15.0309 5V23.75H16.2809V5Z"
                    stroke="black"
                    stroke-width="0.5"
                  />
                </svg>
              </button>
              {/* <button  className="resource-listing__show-more">
                Show More
              </button> */}
            </div>
          ) : (
            ""
          )}
        </div>
        <div className="loader-wrapper">
          <div className="loader">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div>
      </section>
    );
  }
}

export default Listing;
